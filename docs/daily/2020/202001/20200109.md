## 概要

1. AMCL

---

## 疑問点


---

## AMCL

地図データ、センサデータ、オドメトリからロボットの自己位置推定を行う

### MCL

Monte Carlo Localization(モンテカルロ位置推定)
1. ランダムパーティクルの配置
2. 重み更新
3. 移動によるパーティクルのリサンプリング
4. 重み更新

### Augmented MCL

誘拐からの回復、位置推定からの誤り  
残ったパーティクルが間違えている場合回復できない  
パーティクル数が少ない場合や大きな領域に広がっている場合など  
ランダムなパーティクルを加える  

問題  
* 1回のアルゴリズムの繰り返しで何個のパーティクルを加えるか？
* どのような確率分布に従ってパーティクルを生成すべきか？


センサ計測値の確率を監視し、ある時間での確率の平均値を比較する  
短期間の平均値と長期間の平均値  


### サブスクライブトピック

* scan:レーザセンサデータ
* tf
* initialpose:パーティクルフィルタを(再び)初期化する平均及び共分散
* map:use_map_topicパラメータを設定するとレーザセンサの位置を指定するマップを取得する

### パブリッシュトピック

 * amcl_pose:マップ内のロボットの推定位置と共分散
* particlecoud:推定位置のセット、フィルタによって維持している
* tf:変換をodomからmapに公開する

### サービス


* global_localization:大域的な自己位置推定を開始する
* request_nomotion_update:更新を手動実行し、更新されたパーティクルを公開する
* set_map:手動で新しいマップとポーズを設定する

### 呼び出されるサービス

* static_map:amclはこのサービスを利用して、LiDARによる自己位置推定に使用されるマップを取得する

### パラメータ

#### フィルター全体パラメータ

* **min_particles**(int):パーティクルの最小許容数、デフォルトは100
* **max_particles**(int):パーティクルの最大許容数、デフォルトは5000
* **kld_err**(double):真の分布と推定分布の最大誤差、デフォルトは0.01
* **kld_z**(double):(1-p)の上位標準正規分位数、pは推定分布の誤差がkld_errより小さい確率。デフォルトは0.99
* **update_min_d**(double):フィルタの更新をするまでの並進移動の最低距離。デフォルトは0.2[m]
* **update_min_a**(double):フィルタの更新をするまでの回転移動の最低距離。デフォルトはπ/6[rad]
* **resample_interval**(int):リサンプリングする前に必要なフィルター更新の数、デフォルトは2
* **transform_tolerance**(double):TFが以降も有効であることを示すために、パブリッシュしたTFを遅らせる時間。デフォルトは0.1[sed]
* **recovery_aplha_slow**(double):低速平均重みフィルターの指数減衰率、適切な値は0.001。デフォルトは0.0で無効
    * ランダムな姿勢を追加して回復するタイミングを決定する際に使用する
* **recovery_aplha_fast**(double):高速平均重みフィルターの指数減衰率、適切な値は0.01。デフォルトは0.0で無効
* **initial_pose_x**(double):初期ポーズ平均、ガウス分布でフィルター初期化の際に使用。デフォルトは0[m]
* **initial_pose_y**(double):初期ポーズ平均、ガウス分布でフィルター初期化の際に使用。デフォルトは0[m]
* **initial_pose_a**(double):初期ポーズ平均、ガウス分布でフィルター初期化の際に使用。デフォルトは0[rad]
* **initial_cov_xx**(double):初期ポーズ共分散 ( x * x )、ガウス分布でフィルター初期化の際に使用。デフォルトは 0.5 * 0.5[m]
* **initial_cov_yy**(double):初期ポーズ共分散 ( y * y )、ガウス分布でフィルター初期化の際に使用。デフォルトは 0.5 * 0.5[m]
* **initial_cov_aa**(double):初期ポーズ共分散 ( yaw * yaw )、ガウス分布でフィルター初期化の際に使用。デフォルトは π/12 * π/12[rad]
* **gui_publish_rate**(double):視覚化のためにスキャンとパスが公開される最大レート、デフォルトは-0.1[Hz]で無効
* **save_pose_rate**(double):変数initial_**にパラメータサーバへの最後の推定ポーズと共分散を保存する最大頻度、デフォルトは0.5[hz]
    * 保存されたポーズはフィルタ初期化に使用される、-1.0で無効
* **use_map_topic**(bool):trueでマップを受信するサービス呼び出しを行わずにマップトピックをサブスクライブする、デフォルトはfalse
* **first_maの場合のみshort**(double):モデルのz_short部分の混合重み、デフォルトは0.1
* **laser_z_max**(double):モデルのz_max部分の混合重み、デフォルトは0.05
* **laser_z_rand**(double):モデルのz_rand部分の混合重み、デフォルトは0.05
* **laser_sigma_hit**(double):モデルのz_hit部分で使用されるガウスモデルの標準偏差、デフォルトは0.2[m]
* **laser_lambda_short**(double):モデルのz_short部分の指数関数減衰パラメータ、デフォルトは0.1
* **laser_likelihood_max_dist**(double):Likelihood_fieldモデルで使用するためにマップ上で障害物の膨張を行う最大距離、デフォルトは2.0[m]
* **laser_model_type**(string):使用するモデルの選択、デフォルトはlikelihood_field
    * **beam**:
    * **likelihood_field**:
    * **likelihood_field_prob**:
    * 尤度フィールドと同じだが有効な場合はビームスキップ機能が組み込まれている？

#### 走行距離計モデルのパラメータ

* **odom_model_type**(string):使用するモデル、デフォルトはdiff
    * diff
    * omni
    * diff-corrected
    * omni-corrected
* **odom_alpha1**(double):ロボットの運動の回転成分から走行距離計の回転推測値に予想されるノイズ、デフォルトは0.2
* **odom_alpha2**(double):ロボットの動きの並進成分からオドメトリの回転推定値に予想されるノイズ、デフォルトは0.2
* **odom_alpha3**(double):ロボットの運動の並進成分からオドメトリの並進推定値に予想されるノイズ、デフォルトは0.2
* **odom_alpha4**(double):ロボットの運動の回転成分から走行距離計の並進推定値に予想されるノイズ、デフォルトは0.2
* **odom_alpha5**(double):変換関連のノイズパラメータでomniの場合のみ、デフォルトは0.2
* **odom_frame_id**(string):オドメトリに使用するフレーム名、デフォルトはodom
* **base_frame_id**(string):ロボットのベースリンクのフレーム名、デフォルトはbase_link
* **global_frame_id**(string):自己位置推定によってパブリッシュされるフレーム名、デフォルトはmap
* **tf_broadcast**(bool):falseでグローバルフレームとオドメトリフレームの変換を公開しない、デフォルトはtrue














































