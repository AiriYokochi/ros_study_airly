## 本日やったこと
1. Ros講座40の調査
2. Ros講座
3. Ros講座
4. Ros講座

## 時間
10:30-11:20::ROS40の調査\
12:10-14:55::ROS\
15:00-15:30::ROSの調査\
15:30-16:00::ROS\
16:00-16:15::ROSの調査
16:15-17:00::ROS\
17:25-17:35::ROSの調査

## ROS40　車輪ロボットを作る4(gazeboの位置をrvizに取り出す)-2
### 概要
<!-- 何をするもの、方法と結果を３行程度 -->
ROS40について、サンプルが動かなかったので修正した部分を説明する。\

### 所感　時間がかかったこと、難しかった、やりたいことなど
<!-- 
[解決/未解決/所感/疑問/参考など]
[参考][記事名](URL)
 -->
[所感] イナーシャの設定大変、困ったら他のサンプル適当に探して値を探す\
[メモ] gazeboを落とすときはGUIから[☓]を押したあとにCUIで[Cntl+C]\
[参考][QIITA RobotHWSimのプラグインについて](https://qiita.com/MoriKen/items/5cab7436c1b36c25e0ce)
### メモ
現象：サンプルを実行すると車輪が外れている\
修正したファイル：dtw_robot3.xacro, dtw_gazebo4.launch, diff_drive_controller.yaml
#### dtw_gazebo4.launchの修正(なくてもいい)
1. gazeboワールドを読み込むときにポーズをtrueにする
原因解明のため
```
<include file="$(find gazebo_ros)/launch/empty_world.launch">
-   <arg name="paused" value="false"/>
+   <arg name="paused" value="true"/>
```
2. rvizのrequiredをfalseにする
原因解明のため、rvizを落としてもgazeboを落ちないようにする
```
-   <node name="rviz" pkg="rviz" type="rviz" args="-d $(arg rvizconfig)" required="true" />
+   <node name="rviz" pkg="rviz" type="rviz" args="-d $(arg rvizconfig)" required="true" />
```

#### dtw_robot3.xacro
##### 車輪
macroで軸の回転をしていたのをしないようにする\
合わせて回転軸をy軸に変更\
重さを0.1[kg]から3.16[kg]に変更\
イナーシャの変更\
gazeboのkp,kd,mu1の変更
```
<xacro:macro name="wheel_macro" params="parent prefix xyz">

-    <origin xyz="${xyz}" rpy="${radians(-90)} 0 0"/>
-    <axis xyz="0 0 1" />

+    <origin xyz="${xyz}" rpy="0 0 0"/>
+    <axis xyz="0 1 0" />

    <link name="${prefix}_link">
      <inertial>
-        <mass value="0.1"/>
-        <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>

+        <mass value="3.16354494"/>
+        <inertia
+                ixx="0.02296002"
+                ixy="0.00000000" iyy="0.04452360"
+                ixz="0.00000000" iyz="-0.00000001" izz="0.02296002"/>

    <gazebo reference="${prefix}_link">
-        <mu2 value="2.5" />
-        <kp value="50000" />
-        <kd value="10" />

+        <!-- <mu2 value="2.5" /> -->
+        <kp value="500000" />
+        <kd value="100" />
   
```
親リンクをbase_linkにする\
それによって位置の変更をする
```
-    <xacro:wheel_macro prefix="left_wheel"  parent="base_link" xyz="0 0.1 0.05"/>
-    <xacro:wheel_macro prefix="right_wheel" parent="base_link" xyz="0 -0.1 0.05"/>
+    <xacro:wheel_macro prefix="left_wheel" parent="body_link" xyz="0.07 0.1 -0.02"/>
+    <xacro:wheel_macro prefix="right_wheel" parent="body_link" xyz="0.07 -0.1 -0.02"/>
```

##### body_link
重さとイナーシャの変更\
gazebo要素にmu1, kp, kdの追加\
すべてのlinkにmu1, kp, kdの設定をしたほうがいい、gazeboのバージョンによって初期値が違うので
```
    <link name="body_link">
        <inertial>
-            <mass value="1.0"/>
-            <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>

+            <mass value="31.20594944"/>
+            <inertia
+                ixx="1.79583172"
+                ixy="0.03278618" iyy="1.55345103"
+                ixz="0.02535482" iyz="0.01272625" izz="1.22908514"/>
    <gazebo reference="body_link">
+        <mu1 value="0.5" />
+        <kp value="500000" />
+        <kd value="100" />
```
##### ball_link
gazebo要素にkp, kdを追加する\
mu2はいらない
```
    <gazebo reference="ball_link">
-        <mu1 value="0.5" />
-        <mu2 value="0.5" />

+        <mu1 value="0.01" />
+        <kp value="2000000" />
+        <kd value="100" />
+        <!-- <mu2 value="0.5" /> -->
```
##### gazebo
エラーが出たのでそのとおりにする
```
    <gazebo>
            <legacyModeNS>true</legacyModeNS>
```
2019年春以降に
```
      <robotSimType>gazebo_ros_control/DefaultRobotHWSim</robotSimType>
      <legacyModeNS>true</legacyModeNS>
```
ロボットシミュレーションインターフェースのpluginlibの名前が\
gazebo_ros_control/DefaultRobotHWSimで\
モデルがlegacyModeNSで書かれていない時に出るワーニング

#### diff_drive_contoller.yaml
pid_gainが無いエラーが出たので一番下に追加
```
/gazebo_ros_control:
  pid_gains:
    left_wheel_joint:
      p: 10.0
      i: 0.0
      d: 0.0
    right_wheel_joint:
      p: 10.0
      i: 0.0
      d: 0.0
```
---
---
##### 以下テンプレート
## ROS0X　
### 概要
<!-- 何をするもの、方法と結果を３行程度 -->

### 所感　時間がかかったこと、難しかった、やりたいことなど
<!-- 
[解決/未解決/所感/疑問/参考など]
[参考][記事名](URL)
 -->
### メモ
<!--
```
プログラムを書く
```
-->